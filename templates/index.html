{% extends "layout.html" %}
<!-- enter the page title here!-->
{% block title %} Overview {% endblock %}
<!--head-->
{% block head %}
<script src="https://d3js.org/d3.v6.js"></script>
{% endblock %} {% block main %}
<div class="container mx-auto text-center">
  <div class="row mt-4">
    <div class="col">
      <!-- a div where the ingredient graph will take place -->
      <div id="itype_chart"></div>
    </div>
    <div class="col">
      <!-- a div where the product graph will take place -->
      <div id="ptype_chart"></div>
    </div>
    <div class="col">
      <!-- a div where the arrival graph will take place -->
      <div id="arrival_chart"></div>
    </div>
    <div class="col">
      <!-- a div where the shipment graph will take place -->
      <div id="shipment_chart"></div>
    </div>
    <div class="col">
      <!-- a div where the production graph will take place -->
      <div id="production_chart"></div>
    </div>
  </div>

  <!-- charts script -->
  <script>
    // Define a function to create a chart
    function createChart(chartId, data, title) {
        // Set the dimensions and margins of the graph
        const margin = { top: 30, right: 30, bottom: 100, left: 60 },
            width = 400 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // Append the svg object to the specified element
        const svg = d3
            .select(chartId)
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Calculate the Y axis domain
        const maxY = d3.max(data, (d) => d[1]); // Find the maximum value in the data
        const yDomain = [0, maxY * 1.1]; // Adjust the maximum value by 10%

        // Y axis
        const y = d3.scaleLinear().domain(yDomain).range([height, 0]);
        svg.append("g").call(d3.axisLeft(y));

        // X axis
        const x = d3.scaleBand()
            .range([0, width])
            .domain(data.map((d) => d[0]))
            .padding(0.2);
        svg.append("g")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(x))
            .selectAll("text")
            .attr("transform", "translate(-10,0)rotate(-45)")
            .style("text-anchor", "end");

        // Bars
        svg.selectAll("bar")
            .data(data)
            .join("rect")
            .attr("x", (d) => x(d[0]))
            .attr("y", (d) => y(d[1]))
            .attr("width", x.bandwidth())
            .attr("height", (d) => height - y(d[1]))
            .attr("fill", "#69b3a2");

        // Text labels above the bars
        svg.selectAll("label")
            .data(data)
            .join("text")
            .attr("x", (d) => x(d[0]) + x.bandwidth() / 2)
            .attr("y", (d) => y(d[1]) - 10) // Adjust the vertical position of the text
            .text((d) => `${d[1]} Kg`)
            .attr("text-anchor", "middle")
            .style("fill", "black")
            .style("font-size", "12px");

        // Add a title
        svg.append("text")
            .attr("x", width / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text(title);
    }

    // Parse the Data and create charts
    const ingredientsData = {{ ingredients|safe }};
    const productsData = {{ products|safe }};
    const arrivalsData = {{ montharrivals|safe }};
    const shipmentsData = {{ monthshipments|safe }};
    const productionsData = {{ monthproductions|safe }};

    createChart("#itype_chart", ingredientsData, "Ingredients Stock Chart");
    createChart("#ptype_chart", productsData, "Products Stock Chart");
    createChart("#arrival_chart", arrivalsData, "Arrivals of {{ month|safe }} Chart");
    createChart("#shipment_chart", shipmentsData, "Shipments of {{ month|safe }} Chart");
    createChart("#production_chart", productionsData, "Productions of {{ month|safe }} Chart");
  </script>
</div>
{% endblock %}
